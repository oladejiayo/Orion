# ============================================================================
# Orion Service Template — Default Configuration
#
# This is the base configuration that all Orion services start from.
# Override with application-local.yml (dev) or application-docker.yml (Docker).
# ============================================================================

spring:
  application:
    name: ${orion.service.name:service-template}

  # ── Database (US-01-10) ──────────────────────────────────────────────
  # WHY: JPA requires a datasource. These are safe defaults for local dev.
  # Override with profile-specific YAML (local, docker) or env variables.
  datasource:
    url: ${ORION_DB_URL:jdbc:postgresql://localhost:5432/orion}
    username: ${ORION_DB_USER:orion}
    password: ${ORION_DB_PASSWORD:orion_dev_password}
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: validate
    open-in-view: false

  # Disable Spring Boot's default Flyway auto-config.
  # We use FlywayMultiDatabaseConfig from orion-database instead.
  flyway:
    enabled: false

  # Graceful shutdown — let in-flight requests finish before stopping.
  # WHY: Prevents 502s during rolling deployments (Kubernetes sends SIGTERM,
  # service finishes current requests within timeout, then exits cleanly).
  lifecycle:
    timeout-per-shutdown-phase: 30s

server:
  port: 8080
  shutdown: graceful

  # Structured error responses using RFC 7807 ProblemDetail
  error:
    include-message: always
    include-binding-errors: always

# --- Actuator & Observability ---
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics
  endpoint:
    health:
      show-details: when_authorized
      # WHY: Kubernetes probes use /actuator/health/liveness and /readiness
      probes:
        enabled: true
  # Prometheus metrics for /actuator/prometheus
  prometheus:
    metrics:
      export:
        enabled: true

# --- Orion Service Properties ---
orion:
  service:
    name: service-template
    environment: development
    description: Reference service template for Orion platform
    grpc-port: 9090

# --- Logging ---
# WHY: The log pattern includes correlationId from MDC (set by CorrelationIdFilter).
# This enables grep-based request tracing across all log lines.
logging:
  pattern:
    console: "%d{ISO8601} [%thread] %-5level %logger{36} [%X{correlationId:-}] - %msg%n"
  level:
    root: INFO
    com.orion: DEBUG
    org.springframework.web: INFO
